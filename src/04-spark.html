<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>折线图-火花跟随效果</title>
  <script src="../../node_modules/echarts/dist/echarts.min.js"></script>
</head>

<body>
  <div id="main" style="width: 600px;height:400px;background: #010c16;"></div>
</body>

</html>
<script>
  let myChart = echarts.init(document.getElementById('main'));
  let chartsSymbol = {};
  chartsSymbol.lineAnimation = function () {
    return 'image://data:image/png;base64,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'
  }
  let chartData = [{
    "dnxz": 996166,
    "zhs": 4756271,
    "tjsj": "2017",
    "yshs": 2707477,
    "tjsjmc": "2017年"
  }, {
    "dnxz": 1204805,
    "zhs": 5362252,
    "tjsj": "2018",
    "yshs": 3205821,
    "tjsjmc": "2018年"
  }, {
    "dnxz": 1099545,
    "zhs": 5807434,
    "tjsj": "2019",
    "yshs": 3125398,
    "tjsjmc": "2019年"
  }, {
    "dnxz": 1009454,
    "zhs": 6267140,
    "tjsj": "2020",
    "yshs": 2785174,
    "tjsjmc": "2020年"
  }]
  let legend = ["总户数", "有税户数"];
  let colors = ["#698df7", "#f8d263", "#df6c69", "#eec343"];
  let xAxisData = [];
  let seriesData = [];
  let seriesData1 = [];
  let seriesData2 = [];
  let lineanimation1 = [];
  let lineanimation2 = [];
  let yTrickNum = 10000;
  let yaixsName = "户数(万户)";

  function setCharts() {
    chartData.map(item => {
      xAxisData.push(item.tjsjmc);
      let value1 = item.zhs;
      let value2 = item.yshs;
      seriesData1.push({
        name: item.tjsjmc,
        value: value1,
        ...item
      });
      seriesData2.push({
        name: item.tjsjmc,
        value: value2,
        ...item
      });
      lineanimation1.push([item.tjsjmc, value1]);
      lineanimation2.push([item.tjsjmc, value2]);
    });
    seriesData.push({
      name: legend[0],
      type: "line",
      data: seriesData1,
      symbol: "circle" // 折线点设置为实心点
    });
    seriesData.push({
      name: legend[0],
      type: "lines",
      coordinateSystem: "cartesian2d",
      symbolSize: 120,
      polyline: true,
      effect: {
        show: true,
        trailLength: 0,
        // symbol: "circle",
        period: 10, // 光点滑动速度
        symbolSize: 120,
        animationDelayUpdate: function (idx) {
          // 越往后的数据延迟越大
          return idx * 100;
        },
        symbol: chartsSymbol.lineAnimation()
      },
      animationDelay: function (idx) {
        return idx * 10 + 10000;
      },
      lineStyle: {
        normal: {
          width: 1,
          opacity: 0.6,
          curveness: 0.2
        }
      },
      data: [{
        coords: lineanimation1
      }]
    });
    seriesData.push({
      name: legend[1],
      type: "line",
      data: seriesData2,
      symbol: "circle" // 折线点设置为实心点
    });
    seriesData.push({
      name: legend[1],
      type: "lines",
      coordinateSystem: "cartesian2d",
      symbolSize: 120,
      polyline: true,
      effect: {
        show: true,
        trailLength: 0,
        // symbol: "circle",
        period: 10, // 光点滑动速度
        symbolSize: 120,
        animationDelayUpdate: function (idx) {
          // 越往后的数据延迟越大
          return idx * 100;
        },
        symbol: chartsSymbol.lineAnimation()
      },
      animationDelay: function (idx) {
        return idx * 10 + 10000;
      },
      lineStyle: {
        normal: {
          width: 1,
          opacity: 0.6,
          curveness: 0.2
        }
      },
      data: [{
        coords: lineanimation2
      }]
    });
    drawCharts();
  }

  function drawCharts() {
    const option = {
      tooltip: {
        backgroundColor: "rgba(0,0,0,0.7)",
        trigger: "axis",
        textStyle: {
          fontSize: 18
        },
        padding: [10, 15],
        formatter: function (arg) {
          let str = "";
          if (arg.length > 0) {
            str =
              "<div style='text-align:left;'><span style='font-size:18px;'>" +
              arg[0].name +
              "</span><br/>";
            arg.map((item, index) => {
              if (item.value && !(index > 1 && that.sjwd === "1")) {
                str += `<span style='font-size:16px;'>${
                    item.seriesName
                  }：${item.value}户</span><br> `;
              }
            });
            str += "</div>";
          }
          return str;
        }
      },
      color: colors,
      legend: {
        data: legend,
        textStyle: {
          color: "#77c4f9",
          fontSize: 16,
          fontFamily: "MicrosoftYaHei"
        },
        bottom: 0
      },
      grid: {
        left: "6%",
        right: "6%",
        top: "13%",
        bottom: "10%",
        containLabel: true
      },
      xAxis: [{
        type: "category",
        data: xAxisData,
        // boundaryGap: false,
        axisLabel: {
          interval: 0,
          color: "#77c4f9",
          fontFamily: "MicrosoftYaHei",
          fontSize: 16
        },
        axisTick: {
          show: false
        },
        axisLine: {
          lineStyle: {
            color: "#356081"
          }
        },
        axisPointer: {
          type: "shadow"
        }
      }],
      yAxis: [{
        type: "value",
        name: yaixsName,
        nameTextStyle: {
          fontSize: 16
        },
        splitLine: {
          show: false
        },
        axisTick: {
          show: false
        },
        axisLine: {
          lineStyle: {
            color: "#528EB9"
          }
        },
        axisLabel: {
          fontSize: 16,
          color: "#77c4f9",
          fontFamily: "MicrosoftYaHei",
          formatter(value, index) {
            return value / yTrickNum;
          }
        }
      }],
      series: seriesData
    };
    myChart.setOption(option, true);
  }

  setCharts();
</script>